generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(uuid())
  name         String
  email        String        @unique
  passwordHash String
  createdAt    DateTime      @default(now())

  conversations Conversation[]
  attempts      UserProblem[]
}

model Problem {
  id         String        @id @default(uuid())
  title      String
  difficulty String
  tags       String[]      // simple array of tags
  createdAt  DateTime      @default(now())

  conversations Conversation[]
  attempts      UserProblem[]
}

model Conversation {
  id         String     @id @default(uuid())
  user       User       @relation(fields: [userId], references: [id])
  userId     String
  problem    Problem?   @relation(fields: [problemId], references: [id])
  problemId  String?
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt

  messages   Message[]
}

model Message {
  id             String       @id @default(uuid())
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  conversationId String
  sender         String
  text           String
  meta           Json?
  createdAt      DateTime     @default(now())
}

model UserProblem {
  id            String   @id @default(uuid())
  user          User     @relation(fields: [userId], references: [id])
  userId        String
  problem       Problem  @relation(fields: [problemId], references: [id])
  problemId     String
  status        String
  attempts      Int      @default(0)
  firstSeen     DateTime @default(now())
  lastAttempted DateTime?
}
